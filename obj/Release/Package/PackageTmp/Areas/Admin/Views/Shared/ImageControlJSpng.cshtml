
<div id="div_img" name="div_img">
    @model string
       
    @{
        string isRequired = "true";
        WatanART.BLL.BussinessLayer.Generic _Generic = new WatanART.BLL.BussinessLayer.Generic();
        var ImagePath = Model;
        var ImagePathLINK = _Generic.GetFilePath("UploadedImages", "");
        if (!string.IsNullOrEmpty(Model))
        {
            ImagePath = _Generic.GetFilePath("UploadedImages", Model);
            isRequired = "false";
        }

        //isRequired= (string)ViewData["reqired"];
        string @ID = (string)ViewData["ID"];


        if (ViewData["isRequired"] != null)
            isRequired = ViewData["isRequired"].ToString();




    }


    <div class="form-group">
        @Html.Label("ImageLabel", @WatanART.Localization.Resource.ItemImage, new { @class = "col-lg-2 control-label" })
        <div class="col-lg-4">

            <input type="file" id="@ID" name="@ID" value="@ImagePath" accept="image/*"
                   class="form-control text-box"
                   data-bv-notempty="@isRequired"
                   data-bv-notempty-message=@WatanART.Localization.Resource.Required
                   title=@WatanART.Localization.Resource.Select_Image
                   data-bv-field="@ID"
                   onchange="UploadPhoto(event, '@ID', 'hid_@ID', 'ViewImage_@ID');" />

            @Html.ValidationMessage(ID, new { @class = "text-danger" })
        </div>

    </div>



    <div class="form-group">
        <div class="col-md-12">
            <div class="col-lg-12 col-md-2 text-center">
                <div class="gallery" id="links">
                    <a class="gallery-item" href="@ImagePath" name="aViewModuleImage" id="aViewImage" data-gallery>
                        <div class="image">
                            <img src="@ImagePath" alt="Nature Image" class="header-avatar" width="200px" height="200px" name="ViewImage_@ID" id="ViewImage_@ID" />
                        </div>
                    </a>
                </div>
            </div>
        </div>
    </div>

    <input type="hidden" id="hid_@ID" name="@ID" data-validate="false" value="@Model" />

    <script src="~/Areas/Admin/Js/ImageUpload.js"></script>
    <script>

    @*$(document).ready(function () {

       $("#@ID").change(function (e) {
            //if (parseFloat(this.files[0].size) > parseFloat(3 * 1024 * 1024)) {
            //}
           debugger;
           if (this.files && this.files[0]) {
               var reader = new FileReader();
               //$("#hid_@ID").val(this.value);
                 reader.onload = function (e) {
                    $('#ViewImage').attr('src', e.target.result);
                    $("#aViewImage").attr("href", e.target.result)


                }

                reader.readAsDataURL(this.files[0]);
            }
        });

    });*@


        function UploadPhoto(e, file, hiddenImg, ImgScr) {

            fileUpload = $("#" + file).get(0);
           var a =$("#" + fileUpload.id).val();
           
            var extintion = /[^.]+$/.exec(a);
            
            if (validateFileUpload(e, fileUpload, imageExtensionType, file)) {
               
                if (extintion == "png" || extintion == "PNG") {
                    uploadFileInImg(e, fileUpload, imageExtensionType, file, ImgScr, hiddenImg);
                }
                else {
                   
                    swal(" Please Choose png File");
                    $("#" + fileUpload.id).val("");
                }
            }
            else {

                swal(" Please Choose Correct File");
            }
        }
        function UploadVideo(e, file, hiddenImg, ImgScr) {
            fileUpload = $("#" + file).get(0);
            if (validateFileUpload(e, fileUpload, pdfExtensionType, file)) {
                uploadFileInImg(e, fileUpload, pdfExtensionType, file, ImgScr, hiddenImg);
            } else if (validateFileUpload(e, fileUpload, docExtensionType, file)) {
                uploadFileInImg(e, fileUpload, docExtensionType, file, ImgScr, hiddenImg);
            }
            else {

                swal(" Please Choose Correct File");
                $("#" + fileUpload.id).val("");
            }
        }

        function uploadFileInImg(e, fileUpload, fileType, file, ImgScr, HiddenImg) {
            try {
                debugger;
                $('.spinWrap').show();

                var fileId = file;
                var file_list = e.target.files;
                for (var i = 0, file; file = file_list[i]; i++) {
                    var sFileName = file.name;
                    var sFileExtension = sFileName.split('.')[sFileName.split('.').length - 1].toLowerCase();
                    
                    var iFileSize = file.size;
                    var files = fileUpload.files;
                    var data = new FormData();
                    for (var i = 0; i < files.length; i++) {
                        data.append(files[i].name, files[i]);
                    }
                    if (ImgScr == '' || ImgScr == "2") {
                        callGenericHandlerFileInImg(data, file, fileUpload, ImgScr, HiddenImg, fileId);
                    }
                    else {
                        callGenericHandlerFileInImg(data, file, fileUpload, ImgScr, HiddenImg);
                    }
                }
            }
            catch (error) {
                swal("Error");
                $('.spinWrap').hide();
                $("#" + file).val("");



            }
        };
        var imgArray = [];
        var imgArray2 = [];
        function callGenericHandlerFileInImg(data, file, fileUpload, ImgScr, HiddenImg, fileId) {
           
            debugger
            var choice = {};
            choice.url = "/Helpers/FileHandler.ashx";
            choice.type = "POST";
            choice.data = data;
            choice.contentType = false;
            choice.processData = false;
            choice.success = function (result) {
                result = _result_call = result.split(split_char)[1];
                var imagePath = result;
                var srcwithouturl = upload_folder + result;
                //alert('ok');

                if (result == -1 || result == "-1") {
                    swal("Error In the upload Please Try Again");
                    $("#" + fileUpload.id).val("");
                    console.log(fileUpload.id);
                    //alert(fileUpload.id);
                    $('.spinWrap').hide();
                } else {



                    //if (ImgScr == "") {
                    //    $("#" + fileId).parent().find('.multi').append('<div class="deleteWrap oldimage"><img src="' + imagePath + '" alt="' + srcwithouturl + '" class="imgSize"/><i class="fa fa-times deleteImg"></i></div>');
                    //    $('.deleteWrap').css('display', 'inline-block');
                    //    var lastIndex = imagePath.lastIndexOf("/");
                    //    //var s2 ='/upload/'+imagePath.substring(lastIndex + 1);
                    //    var s2 = upload_folder + result;
                    //    var lsitobj = { "Image": s2 }
                    //    imgArray.push(lsitobj);
                    //}
                    //else {
                    //    debugger
                    //    if (ImgScr == "2") {
                    //        $("#" + fileId).parent().find('.multi').append('<div class="deleteWrap oldimage2"><img src="' + imagePath + '" alt="' + srcwithouturl + '" class="imgSize"/><i class="fa fa-times deleteImg2"></i></div>');
                    //        $('.deleteWrap').css('display', 'inline-block');
                    //        var lastIndex = imagePath.lastIndexOf("/");
                    //        //var s2 ='/upload/'+imagePath.substring(lastIndex + 1);
                    //        var s2 = upload_folder + result;
                    //        var lsitobj = { "Image": s2 }
                    //        imgArray2.push(lsitobj);
                    //    } else {
                    //        $("#" + ImgScr).attr("src", imagePath);
                    //    }


                    //}



                    var imagePath = '@ImagePathLINK' + result;
                    $("#" + ImgScr).attr("src", "");
                    $("#" + ImgScr).attr("src", imagePath);
                    DeleteOldImageInsert(HiddenImg, result);

                    $('.spinWrap').hide();
                }

            };
            choice.error = function (error) {
                swal(" Error");
                $('.spinWrap').hide();
                $("#" + file).val("");


            };
            return $.ajax(choice);
            event.preventDefault();
        }


        function DeleteOldImageInsert(HiddenImg, result) {
            debugger;

            var OldImage = $("#" + HiddenImg).val();

            var url = '@Url.Action("DeleteImageajax", "Shared")';
            $.ajax({
                url: url,
                data: { ImageName: OldImage },
                cache: false,
                type: "POST",
                success: function (data) {
                    var dataRes = data;
                    if (dataRes > 0) {

                    } else {
                        //  swal("Error occurred");
                    }

                    $("#" + HiddenImg).val(result);


                }


            });
        }

    </script>


</div>